<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Daftar</title>
  <link href="https://cdn.jsdelivr.net/npm/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="gridstyle.css">
  <link rel="stylesheet" href="displaybox.css">
  <script src="https://cdn.jsdelivr.net/npm/gridjs/dist/gridjs.umd.js"></script>
  <script src="nav.js"></script>
</head>
<body>
  <h1>Daftar</h1>
  <header-component></header-component>
  <div id="loading">Loading data...</div>
  <div id="grid"></div>
  <div class="info-container">
    <div id="row-count-box" class="info-box" style="display: none;">
      Total: <span id="row-count">0</span>
    </div>
    <div id="column-l-box" class="info-box" style="display: none;">
      Lelaki: <span id="column-l-count">0</span>
    </div>
    <div id="column-p-box" class="info-box" style="display: none;">
      Perempuan: <span id="column-p-count">0</span>
    </div>
    <div id="komisen-box" class="info-box" style="display: none;">
      Komisen MTQ: RM<span id="komisen-total">0</span>
    </div>
  </div>

  <script>
    // Replace with your web app URL
    const sheetUrl = "https://script.google.com/macros/s/AKfycbwZN-G5pSmiDU0eQzhV2jv-8obtakQ9P0RpLhJzrvwh7seZu6XChNZsbc5-4ItUthkEmg/exec";

    fetch(sheetUrl)
      .then(response => response.json())
      .then(data => {
        document.getElementById('loading').style.display = 'none';

        // Check if data exists
        if (!data.length) {
          document.getElementById('loading').textContent = 'No data available.';
          return;
        }

        // Extract headers and rows for Grid.js
        const headers = Object.keys(data[0]);
        const rows = data.map(row => Object.values(row));

        // Initialize Grid.js
        new gridjs.Grid({
          columns: headers,
          data: rows,
          search: true,
          sort: true,
          pagination: {
            enabled: true,
            limit: 10,
          },
        }).render(document.getElementById('grid'));

        // Update row count display
        const rowCountBox = document.getElementById('row-count-box');
        const rowCount = document.getElementById('row-count');
        rowCount.textContent = rows.length;
        rowCountBox.style.display = 'block';

        // Count occurrences of "L" in column 6
        const columnIndexL = 5; // 0-based index for column 6
        const lCount = rows.filter(row => row[columnIndexL] === "L").length;
        const lCountBox = document.getElementById('column-l-box');
        document.getElementById('column-l-count').textContent = lCount;
        lCountBox.style.display = 'block';

        // Count occurrences of "P" in column 6
        const pCount = rows.filter(row => row[columnIndexL] === "P").length;
        const pCountBox = document.getElementById('column-p-box');
        document.getElementById('column-p-count').textContent = pCount;
        pCountBox.style.display = 'block';

        // Calculate total for column 8 (Komisen MTQ)
        const columnIndexKomisen = 7; // 0-based index for column 8
        const komisenTotal = rows.reduce((sum, row) => sum + (parseFloat(row[columnIndexKomisen]) || 0), 0);
        const komisenBox = document.getElementById('komisen-box');
        document.getElementById('komisen-total').textContent = komisenTotal.toFixed(2); // Format to 2 decimal places
        komisenBox.style.display = 'block';
      })
      .catch(err => {
        console.error('Error fetching data:', err);
        document.getElementById('loading').textContent = 'Failed to load data.';
      });
  </script>
</body>
</html>
